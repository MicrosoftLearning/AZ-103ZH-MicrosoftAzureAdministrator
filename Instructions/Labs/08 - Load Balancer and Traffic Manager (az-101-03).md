---
lab:
    title: '负载均衡器和流量管理器'
    module: '模块 08 - 网络流量管理'
---

# 实验：负载均衡器和流量管理器

本练习中的所有任务都是从 Azure 门户（包括 PowerShell Cloud Shell 会话）执行的，但练习 1 中的任务 3 除外，其中的某些步骤是从与 Azure VM 的远程桌面会话中执行

实验文件： 

-  **Labfiles\\Module_08\\Load_Balancer_and_Traffic_Manager\\az-101-03_01_azuredeploy.json**

-  **Labfiles\\Module_08\\Load_Balancer_and_Traffic_Manager\\az-101-03_01_1_azuredeploy.parameters.json**

-  **Labfiles\\Module_08\\Load_Balancer_and_Traffic_Manager\\az-101-03_01_2_azuredeploy.parameters.json**

### 场景
  
Adatum Corporation 希望通过利用 Azure 负载均衡器的负载均衡和网络地址转换 (NAT) 功能，以高度可用的方式实现 Azure VM 托管的 Web 工作负荷，并为其子公司 Contoso Corporation 的管理提供便利


### 目标
  
完成本实验室后，你将能够：

-  使用 Azure 资源管理器模板部署 Azure VM

-  Azure 负载均衡器

-  实施 Azure 流量管理器负载均衡


### 练习 0：使用 Azure 资源管理器模板部署 Azure VM
  
本练习的主要任务具体如下：

1. 使用 Azure 资源管理器模板部署管理运行 Windows Server 2016 Datacenter 的 Azure VM，并将 Web 服务器（IIS）角色安装到第一个 Azure 区域中的可用性集中

1. 使用 Azure 资源管理器模板部署管理运行 Windows Server 2016 Datacenter 的 Azure VM，并将 Web 服务器（IIS）角色安装到第二个 Azure 区域中的可用性集中


#### 任务1：使用 Azure 资源管理器模板部署管理运行 Windows Server 2016 Datacenter 的 Azure VM，并将 Web 服务器（IIS）角色安装到第一个 Azure 区域中的可用性集中

1. 在实验虚拟机中，启动 Microsoft Edge，导航到 Azure 门户 ([**http://portal.azure.com**](http://portal.azure.com))，并使用在目标 Azure 订阅中拥有所有者角色的 Microsoft 帐户登录。

1. 在 Azure 门户中，导航到 **创建资源** 边栏选项卡。

1. 从 **创建资源** 边栏选项卡，在 Azure Marketplace 搜索 **模板部署**。

1. 使用搜索结果列表导航到 **部署自定义模板** 边栏选项卡。

1. 在**“自定义部署”**边栏选项卡中，单击**“在编辑器中生成自己的模板”**链接。如果未看到此链接，请改为单击**“编辑模板”**。

1. 在**“编辑模板”**边栏选项卡中，加载模板文件 **Labfiles\\Module_08\\Load_Balancer_and_Traffic_Manager\\az-101-03_01_azuredeploy.json**。 

   > **备注**：查看模板的内容，注意其定义了将托管 Windows Server 2016 Datacenter Core 的两个 Azure VM 部署到可用性集中。

1. 保存模板并返回到**自定义部署**边栏选项卡。 

1. 从**自定义部署**边栏选项卡，导航到**编辑参数**边栏选项卡。

1. 在**“编辑参数”**边栏选项卡中，加载参数文件 **Labfiles\\Module_08\\Load_Balancer_and_Traffic_Manager\\az-101-03_01_1_azuredeploy.parameters.json**。 

1. 保存参数并返回到**自定义部署**边栏选项卡。 

1. 从**自定义部署**边栏选项卡，使用以下设置初始化模板部署：

    - 订阅：将在本实验中使用的订阅的名称

    - 资源组：新资源组 **az1010301-RG** 的名称

    - 位置：最接近实验室位置的 Azure 区域的名称，在那里你可以配置 Azure VM

    - 管理员用户名：**学生**

    - 管理员密码：**Pa55w.rd1234**

    - Vm 名称前缀： **az1010301w-vm**

    - Nic 名称前缀：**az1010301w-nic**

    - 图像发布者：**MicrosoftWindowsServer**

    - 图像产品：**WindowsServer**

    - 映像 SKU：**2016-Datacenter**

    - Vm 大小：根据讲师的建议，使用**Standard_DS1_v2**或**Standard_DS2_v2**

    - 虚拟网络名称：**az1010301-vnet**

    - 地址前缀：**10.101.31.0/24**

    - 虚拟网络资源组：**az1010301-RG**

    - Subnet0Name: **subnet0**

    - Subnet0Prefix: **10.101.31.0/26**

    - 可用性集名称：**az1010301w-avset**

    - 网络安全组名称：**az1010301w-vm-nsg**

    - 模块网址：**https://github.com/Azure/azure-quickstart-templates/raw/master/dsc-extension-iis-server-windows-vm/ContosoWebsite.ps1.zip**

    - 配置功能：**ContosoWebsite.ps1\\ContosoWebsite**

   > **备注**：要确认可以配置 Azure VM 的 Azure 区域，请参阅 [**https://azure.microsoft.com/zh-cn/regions/offers/**](https://azure.microsoft.com/zh-cn/regions/offers/)

   > **备注**：请勿等待部署完成，而是继续进行下一项任务。 


#### 任务 2：使用 Azure 资源管理器模板部署管理运行 Windows Server 2016 Datacenter 的 Azure VM，并将 Web 服务器（IIS）角色安装到第二个 Azure 区域中的可用性集中

1. 在 Azure 门户中，导航到 **创建资源** 边栏选项卡。

1. 从 **创建资源** 边栏选项卡，在 Azure Marketplace 搜索 **模板部署**。

1. 使用搜索结果列表导航到 **部署自定义模板** 边栏选项卡。

1. 在**“自定义部署”**边栏选项卡中，单击**“在编辑器中生成自己的模板”**链接。如果未看到此链接，请改为单击**“编辑模板”**。

1. 在**“编辑模板”**边栏选项卡中，加载模板文件 **Labfiles\\Module_08\\Load_Balancer_and_Traffic_Manager\\az-101-03_01_azuredeploy.json**。 

   > **备注**：这是你在上一任务中使用的同一模板。您将使用它将一对 Azure VM 部署到第二个区域。 

1. 保存模板并返回到**自定义部署**边栏选项卡。 

1. 从**自定义部署**边栏选项卡，导航到**编辑参数**边栏选项卡。

1. 在**“编辑参数”**边栏选项卡中，加载参数文件 **Labfiles\\Module_08\\Load_Balancer_and_Traffic_Manager\\az-101-03_01_2_azuredeploy.parameters.json**。 

1. 保存参数并返回到**自定义部署**边栏选项卡。 

1. 从**自定义部署**边栏选项卡，使用以下设置初始化模板部署：

    - 订阅：你在此实验室中使用的订阅的名称

    - 资源组：新资源组名称**az1010302-RG**

    - 位置：Azure 区域的名称与在上一任务中选择的名称不同，可以在其中配置 Azure VM

    - 管理员用户名：**学生**

    - 管理员密码：**Pa55w.rd1234**

    - Vm 名称前缀： **az1010302w-vm**

    - Nic 名称前缀：**az1010302w-nic**

    - 图像发布者：**MicrosoftWindowsServer**

    - 图像产品：**WindowsServer**

    - 映像 SKU：**2016-Datacenter**

    - Vm 大小：根据讲师的建议，使用**Standard_DS1_v2**或**Standard_DS2_v2**

    - 虚拟网络名称：**az1010302-vnet**

    - 地址前缀：**10.101.32.0/24**

    - 虚拟网络资源组：**az1010302-RG**

    - Subnet0Name: **subnet0**

    - Subnet0Prefix: **10.101.32.0/26**

    - 可用性集名称：**az1010302w-avset**

    - 网络安全组名称：**az1010302w-vm-nsg**

    - 模块网址：**https://github.com/Azure/azure-quickstart-templates/raw/master/dsc-extension-iis-server-windows-vm/ContosoWebsite.ps1.zip**

    - 配置功能：**ContosoWebsite.ps1\\ContosoWebsite**

   > **备注**：无需等待部署完成即可继续进行下一项练习。

> **结果**：完成本练习后，你已使用 Azure 资源管理器模板启动运行 Windows Server 2016 Datacenter 的 Azure VM 的部署，并将 Web 服务器 (IIS) 角色安装到两个 Azure 区域的可用性集中。


### 练习 1： Azure 负载均衡器
  
本练习的主要任务具体如下：

1. 在第一个区域中实施 Azure 负载均衡规则。

1. 在第二个区域中实施 Azure 负载均衡规则。

1. 在第一个区域中实施 Azure NAT 规则。

1. 在第二个区域中实施 Azure NAT 规则。

1. 验证 Azure 负载均衡和 NAT 规则


#### 任务1：在第一个区域中实施 Azure 负载均衡规则

   > **备注**：开始此任务之前，请确保您在上次练习的第一个任务中启动的模板部署已经完成。 

1. 在 Azure 门户中，导航到 **创建资源** 边栏选项卡。

1. 从**创建资源**边栏选项卡，搜索 Azure Marketplace 中的**负载均衡器**。

1. 请使用搜索结果列表，导航到**创建负载均衡**器边栏选项卡。

1. 从**创建负载均衡**器边栏选项卡中，使用以下设置创建新的 Azure 负载均衡器：

    - 名称：**az1010301w-lb**

    - 类型：**公共**

    - SKU：**基本**

    - 公共 IP 地址：一个名为 **az1010301w-lb-pip** 的新公共 IP 地址

    - 转让：**动态**

    - 订阅：你用于本实验室的订阅名称

    - 资源组：**az1010301-RG**

    - 位置：您在上一练习的第一个任务中部署 Azure VM 的 Azure 区域的名称

1. 在 Azure 门户中，导航到新部署的 Azure 负载均衡器 **az1010301w-lb** 的边栏选项卡。

1. 从 **az1010301w-lb** 边栏选项卡，显示 **az1010301w-lb 后端池**边栏选项卡。

1. 从 **az1010301w-lb -后端池**边栏选项卡，添加具有以下设置的后端池：

    - 名称：**az1010301w-bepool**

    - IP 版本：**IPv4**

    - 关联：**可用性集**

    - 可用性集：**az1010301w-avset**

    - 虚拟机：**az1010301w-vm0** 

    - 网络 IP 配置：**az1010301w-nic0/ipconfig1 (10.101.31.4)**

    - 虚拟机：**az1010301w-vm1** 

    - 网络 IP 配置：**az1010301w-nic1/ipconfig1 (10.101.31.5)**

   > **备注**：可能会按相反顺序分配 Azure VM 的 IP 地址。 

   > **备注**：等待操作完成。这应该需要不到一分钟。

1. 从 **az1010301w-lb - 后端池**边栏选项卡，显示 **az1010301w-lb - 运行状况探测**边栏选项卡。

1. 从 **az1010301w-lb - 运行状况探测**边栏选项卡，添加具有以下设置的运行状况探测：

    - 名称：**az1010301w-healthprobe**

    - 协议：**TCP**

    - 端口：**80**

    - 间隔：**5** 秒

    - 不正常阈值：**2** 个连续故障

    > **备注**：等待操作完成。这应该需要不到一分钟。

1. 从 **az1010301w-lb - 运行状况探测**边栏选项卡，显示 **az1010301w-lb - 负载均衡规则**边栏选项卡。

1. 从 **az1010301w-lb - 负载均衡规则**边栏选项卡，添加具有以下设置的负载均衡规则：

    - 名称：**az1010301w-lbrule01**

    - IP 版本：**IPv4**

    - 前端 IP 地址：**LoadBalancerFrontEnd**

    - 协议：**TCP**

    - 端口：**80**

    - 后端端口：**80**

    - 后端池：**az1010301w-bepool（2 台虚拟机）**

    - 运行状况探测：**az1010301w-healthprobe (TCP:80)**

    - 会话持久性：**无**

    - 空闲超时（分钟）：**4**

    - 浮动 IP（直接服务器返回）：**禁用**


#### 任务 2：在第二个区域中实施 Azure 负载均衡规则

   > **备注**：开始此任务之前，请确保您在上次练习的第二个任务中启动的模板部署已经完成。 

1. 在 Azure 门户中，导航到 **创建资源** 边栏选项卡。

1. 从**创建资源**边栏选项卡，搜索 Azure Marketplace **中的负载均衡器**。

1. 请使用搜索结果列表，导航到创**建负载均衡器**边栏选项卡。

1. 从**创建负载均衡器**边栏选项卡中，使用以下设置创建新的 Azure 负载均衡器：

    - 名称：**az1010302w-lb**

    - 类型：**公共**

    - SKU：**基本**

    - 公共 IP 地址：一个名为 **az1010302w-lb-pip** 的新公共 IP 地址

    - 转让：**动态**

    - 订阅：你用于本实验室的订阅名称

    - 资源组：**az1010302-RG**

1. 在 Azure 门户中，导航到新部署的 Azure 负载均衡器 **az1010302w-lb** 的边栏选项卡。

1. 从 **az1010302w-lb** 边栏选项卡，显示 **az1010302w-lb 后端池**边栏选项卡。

1. 从 **az1010302w-lb - 后端池**边栏选项卡，添加具有以下设置的后端池：

    - 名称：**az1010302w-bepool**

    - IP 版本：**IPv4**

    - 关联：**可用性集**

    - 可用性集：**az1010302w-avset**

    - 虚拟机：**az1010302w-vm0** 

    - 网络 IP 配置：**az1010302w-nic0/ipconfig1 (10.101.32.4)**

    - 虚拟机：**az1010302w-vm1** 

    - 网络 IP 配置：**az1010302w-nic1/ipconfig1 (10.101.32.5)**

   > **备注**：可能会按相反顺序分配 Azure VM 的 IP 地址。 

   > **备注**：等待操作完成。这应该需要不到一分钟。

1. 从 **az1010302w-lb - 后端池**边栏选项卡，显示 **az1010302w-lb - 运行状况探测**边栏选项卡。

1. 从 **az1010302w-lb - 运行状况探测**边栏选项卡，添加具有以下设置的运行状况探测：

    - 名称：**az1010302w-healthprobe**

    - 协议：**TCP**

    - 端口：**80**

    - 间隔：**5** 秒

    - 不正常阈值：**2** 个连续故障

    > **备注**：等待操作完成。这应该需要不到一分钟。

1. 从 **az1010302w-lb - 运行状况探测**边栏选项卡，显示 **az1010302w-lb - 负载均衡规则**边栏选项卡。

1. 从 **az1010302w-lb - 负载均衡规则**边栏选项卡，添加具有以下设置的负载均衡规则：

    - 名称：**az1010302w-lbrule01**

    - IP 版本：**IPv4**

    - 前端 IP 地址：**LoadBalancerFrontEnd**

    - 协议：**TCP**

    - 端口：**80**

    - 后端端口：**80**

    - 后端池：**az1010302w-bepool（2 台虚拟机）**

    - 运行状况探测：**az1010302w-healthprobe (TCP:80)**

    - 会话持久性：**无**

    - 空闲超时（分钟）：**4**

    - 浮动 IP（直接服务器返回）：**禁用**


#### 任务 3：在第一个区域中实施 Azure NAT 规则

1. 在 Azure 门户中，导航到 Azure 负载均衡器 **az1010301w-lb** 的边栏选项卡。

1. 从 **az1010301w-lb** 边栏选项卡，显示 **az101031w-lb-入站 NAT 规则**边栏选项卡。

   > **备注**：NAT 功能不依赖于运行状况探测。

1. 从 **az1010301w-lb-入站 NAT 规则**边栏选项卡，添加具有以下设置的第一个入站 NAT 规则：

    - 名称：**az1010301w-vm0-RDP**

    - 前端 IP 地址：**LoadBalancerFrontEnd**

    - IP 版本：**IPv4**

    - 服务：**自定义**

    - 协议：**TCP**

    - 端口：**33890**

    - 目标虚拟机：**az1010301w-vm0**

    - 网络 IP 配置：**ipconfig1 (10.101.31.4)** 或 **ipconfig1 (10.101.31.5)**

    - 端口映射：**自定义**

    - 浮动 IP（直接服务器返回）：**禁用**

    - 目标端口：**3389**

    > **备注**：等待操作完成。这应该需要不到一分钟。

1. 从 **az1010301w-lb - 入站 NAT 规则**边栏选项卡，添加具有以下设置的第二个入站 NAT 规则：

    - 名称：**az1010301w-vm1-RDP**

    - 前端 IP 地址：**LoadBalancerFrontEnd**

    - IP 版本：**IPv4**

    - 服务：**自定义**

    - 协议：**TCP**

    - 端口：**33891**

    - 目标虚拟机：**az1010301w-vm1**

    - 网络 IP 配置：**ipconfig1 (10.101.31.4)**或 **ipconfig1 (10.101.31.5)**

    - 端口映射：**自定义**

    - 浮动 IP（直接服务器返回）：**禁用**

    - 目标端口：**3389**

    > **备注**：等待操作完成。这应该需要不到一分钟。


#### 任务 4：在第二个区域中实施 Azure NAT 规则

1. 在 Azure 门户中，导航到 Azure 负载均衡器 **az1010302w-lb** 的边栏选项卡。

1. 从 **az1010302w-lb** 边栏选项卡，显示 **az1010302w-lb - 入站 NAT 规则**边栏选项卡。

1. 从 **az1010302w-lb-入站 NAT 规则**边栏选项卡，添加具有以下设置的第一个入站 NAT 规则：

    - 名称：**az1010302w-vm0-RDP**

    - 前端 IP 地址：**LoadBalancedFrontEnd**

    - IP 版本：**IPv4**

    - 服务：**自定义**

    - 协议：**TCP**

    - 端口：**33890**

    - 目标虚拟机：**az1010302w-vm0**

    - 网络 IP 配置：**ipconfig1 (10.101.32.4)**或 **ipconfig1 (10.101.32.5)**

    - 端口映射：**自定义**

    - 浮动 IP（直接服务器返回）：**禁用**

    - 目标端口：**3389**

    > **备注**：等待操作完成。这应该需要不到一分钟。

1. 从 **az1010302w-lb - 入站 NAT 规则**边栏选项卡，添加具有以下设置的第二个入站 NAT 规则：

    - 名称：**az1010302w-vm1-RDP**

    - 前端 IP 地址：**LoadBalancedFrontEnd**

    - IP 版本：**IPv4**

    - 服务：**自定义**

    - 协议：**TCP**

    - 端口：**33891**

    - 目标虚拟机：**az1010302w-vm1**

    - 网络 IP 配置：**ipconfig1 (10.101.32.4)**或 **ipconfig1 (10.101.32.5)**

    - 端口映射：**自定义**

    - 浮动 IP（直接服务器返回）：**禁用**

    - 目标端口：**3389**

    > **备注**：等待操作完成。这应该需要不到一分钟。


#### 任务 5：验证 Azure 负载均衡和 NAT 规则。

1. 在 Azure 门户中，导航到 Azure 负载均衡器 **az1010301w-lb** 的边栏选项卡。

1. 在 **az1010301w-lb** 边栏选项卡上，标识分配给负载均衡器前端的公共 IP 地址。

1. 在 Microsoft Edge 窗口中，打开一个新选项卡，并浏览到您在上一步中识别的 IP 地址。

1. 确认选项卡显示默认的 Internet 信息服务主页。

1. 关闭显示默认 Internet 信息服务主页的浏览器选项卡。

1. 在 Azure 门户中，导航到 Azure 负载均衡器 **az1010301w-lb** 的边栏选项卡。

1. 在 **az1010301w-lb** 边栏选项卡上，标识分配给负载均衡器前端的公共 IP 地址。

1. 在逻辑阵列模块虚拟机中，使用您在上一任务中确定的 IP 地址替换&lt;az1010301w-lb_public_IP&lt;占位符后，运行以下命令：

```
   mstsc /v:<az1010301w-lb_public_IP>:33890
```

   > **备注**：此命令使用您在上一任务中创建的 **az1010301w-vm0-RDP** NAT 规则，启动到 **az1010301w-vm0** Azure VM 的远程桌面会话。

1. 当系统提示您登录时，请提供以下凭据：

    - 管理员用户名：**学生**

    - 管理员密码：**Pa55w.rd1234**

1. 登录后，在命令提示符下运行以下命令：

```
   hostname
```

1. 查看输出并验证您是否实际连接到 **az1010301w-vm0** Azure VM。

   > **备注**：对第二个区域重复相同的测试。

> **结果**：完成本练习后，你已在两个 Azure 区域中实施了 Azure 的负载平衡规则和 NAT 规则，并在第一个区域中验证了 Azure 负载平衡器的负载平衡规则和 NAT 规则。


### 练习 2：实施 Azure 流量管理器负载均衡

本练习的主要任务具体如下：

1. 将 DNS 名称分配给 Azure 负载均衡器的公共 IP 地址

1. 实施 Azure 流量管理器负载均衡

1. 验证 Azure 流量管理器负载均衡


#### 任务1：将 DNS 名称分配给 Azure 负载均衡器的公共 IP 地址

   > **备注**：此任务是必要的，因为每个流量管理器终结点都必须分配一个 DNS 名称。 

1. 在 Azure 门户中，导航到名为 **az1010301w-lb-pip** 的第一个区域中与 Azure 负载均衡器关联的公共 IP 地址资源的边栏选项卡。 

1. 从 **az1010301w-lb-pip** 边栏选项卡，显示其**配置**边栏选项卡。 

1. 从 **az1010301w-lb-pip - 配置**边栏选项卡将公共 IP 地址的 **DNS 名称标签**设置为唯一值。 

   > **备注**：**DNS 名称标签（可选）**文本框中的绿色复选标记将指示您输入的名称是否有效且唯一。 

1. 导航到名为 **az1010302w-lb-pip** 的第二个区域中与 Azure 负载均衡器关联的公共 IP 地址资源的边栏选项卡。 

1. 从 **az1010302w-lb-pip** 边栏选项卡，显示其**配置**边栏选项卡。 

1. 从 **az1010302w-lb-pip - 配置**边栏选项卡将公共 IP 地址的 **DNS 名称标签**设置为唯一值。 

   > **备注**：**DNS 名称标签（可选）**文本框中的绿色复选标记将指示您输入的名称是否有效且唯一。 


#### 任务2：实施 Azure 流量管理器负载均衡

1. 在 Azure 门户中，导航到 **创建资源** 边栏选项卡。

1. 从**创建资源**边栏选项卡中，搜索 Azure Marketplace 中的 **Traffic Manager 个人资料**。

1. 使用搜索结果列表导航到**创建流量管理器个人**资料边栏选项卡。

1. 从**创建流量管理器个人**资料边栏选项卡，使用以下设置创建新的 Azure 流量管理器个人资料：

    - 名称：trafficmanager.net DNS 命名空间中的全局唯一名称

    - 路由方法：**加权**

    - 订阅：你用于本实验室的订阅名称

    - 资源组：新资源组的名称 **az1010303-RG**

    - 位置：您之前在本逻辑阵列模块中使用的任何一个 Azure 区域

1. 在 Azure 门户中，导航到新预配的流量管理器配置文件的边栏选项卡。

1. 在“流量管理器配置文件”边栏选项卡中，显示其**“配置”**边栏选项卡并查看配置设置。

   > **备注**：流量管理器配置文件 DNS 记录的默认 TTL 为 60 秒

1. 在“流量管理器配置文件”边栏选项卡中，显示其**“终结点”**边栏选项卡。

1. 在**“终结点”**边栏选项卡中，添加具有以下设置的第一个终结点：

    - 类型：**Azure 终结点**

    - 名称：**az1010301w-lb-pip**

    - 目标资源类型：**公共 IP 地址**

    - 目标资源：**az1010301w-lb-pip**

    - 权重：**100**

    - 自定义页眉设置：保留为空

    - 添加为禁用：保留为空

1. 在**“终结点”**边栏选项卡中，添加具有以下设置的第二个终结点：

    - 类型：**Azure 终结点**

    - 名称：**az1010302w-lb-pip**

    - 目标资源类型：**公共 IP 地址**

    - 目标资源：**az1010302w-lb-pip**

    - 权重：**100**

    - 自定义页眉设置：保留为空

    - 添加为禁用：保留为空

1. 在**“终结点”**边栏选项卡中，检查两个终结点的**“监视状态”**列中的条目。请等待两个终结点都列为**联机**状态，然后再继续执行下一个任务。


#### 任务3：验证 Azure 流量管理器负载均衡

1. 在**“终结点”**边栏选项卡上，切换到“流量管理器配置文件”边栏选项卡的**“概述”**部分。

1. 请记下向流量管理器配置文件分配的 DNS 名称（位于 **http://** 前缀之后的字符串）。 

1. 从 Azure 门户，在 Cloud Shell 窗格中启动 PowerShell 会话。 

   > **备注**： 如果这是你第一次在当前 Azure 订阅中启动 Cloud Shell，则会要求你创建 Azure 文件共享以保留 Cloud Shell 文件。此时，请接受默认设置，这将在自动生成的资源组中创建存储帐户。

1. 在 Cloud Shell 窗格中，运行以下命令，将&lt;TM_DNS_name&lt;占位符替换为分配给您在上一任务中标识的流量管理器个人资料的 DNS 名称的值：

```
   nslookup <TM_DNS_name>
```

1. 查看输出并记下**名称**条目。这应该与您在上一任务中创建的一个流量管理器个人资料终结点的 DNS 名称相匹配。

1. 等待至少 60 秒，然后再次运行相同的命令：

```
   nslookup <TM_DNS_name>
```
1. 查看输出并记下**名称**条目。此时，条目应与您在上一任务中创建的其他流量管理器个人资料终结点的 DNS 名称相匹配。

> **结果**：完成本次练习后，您已实施并验证了 Azure 流量管理器负载均衡

## 练习 3：移除实验室资源

#### 任务1：打开 Cloud Shell

1. 在门户顶部，单击**“Cloud Shell”**图标，打开 Cloud Shell 窗格。

1. 在 Cloud Shell 界面中，选择**“Bash”**。

1. 在 **Cloud Shell** 命令提示符处，键入以下命令并按 **Enter** 键列出你在本实验室中创建的所有资源组：

```sh
   az group list --query "[?starts_with(name,'az101030')].name" --output tsv
```

1. 验证输出中是否仅包含在本练习中创建的资源组。将在下一个任务中删除这些资源组。

#### 任务2：删除资源组

1. 在 **Cloud Shell** 命令提示符处，键入以下命令并按 **Enter** 键以删除你在本实验室中创建的资源组

```sh
   az group list --query "[?starts_with(name,'az101030')].name" --output tsv | xargs -L1 bash -c 'az group delete --name $0 --no-wait --yes'
```

1. 关闭门户底部的 **Cloud Shell** 提示。

> **结果**：在本练习中，将删除本实验室中使用的资源。
